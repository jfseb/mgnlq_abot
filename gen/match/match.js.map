{"version":3,"sources":["/projects/nodejs/botbuilder/fdevstart/src/../src/match/match.ts"],"names":[],"mappings":"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","file":"match/match.js","sourcesContent":["/**\n * @file match\n * @module jfseb.fdevstart.match\n * @copyright (c) Gerd Forstmann\n *\n *\n * Judging function for a match\n */\n\n\nimport * as debug from 'debug';\nconst debuglog = debug('match');\nimport * as IMatch from './ifmatch';\nimport * as stream from 'stream';\n\n\nfunction weakenByN(a: number, n: number): number {\n  return 1.0 + (a - 1.0) / n;\n}\n\nexport function calcRankingProduct(oSet: { [key: string]: IMatch.IWord }): number {\n  var factor = Object.keys(oSet).reduce(function (prev, sCategory) {\n    return prev *= oSet[sCategory]._ranking;\n  }, 1.0);\n  return factor;\n}\n\nfunction calcGeometricMeansOfRanking(oSet: { [key: string]: IMatch.IWord }) {\n  var keys = Object.keys(oSet);\n  if (!keys.length) {\n    return 1.0;\n  }\n  var factor = calcRankingProduct(oSet);\n  return Math.pow(factor, 1 / keys.length);\n}\n/**\n * Calculate a number to rank a matched tool\n *\n *\n */\nexport function rankToolMatch(a: IMatch.IToolMatchResult): number {\n  var missing = Object.keys(a.missing || {}).length;\n  var required = Object.keys(a.required || {}).length;\n  var optional = Object.keys(a.optional || {}).length;\n  var spurious = Object.keys(a.spurious || {}).length;\n  var matching = required + optional;\n  debuglog(debuglog.enabled ? (\"caluclating rank of \" + JSON.stringify(a)) : '-');\n  var rankingRequired = calcGeometricMeansOfRanking(a.required);\n  var rankingOptional = calcGeometricMeansOfRanking(a.optional);\n\n  // 1.1 for every optional;\n\n  //  0.9 for every spurious\n  //  for every required\n  var spuriousDeprec = Math.pow(0.9, Object.keys(a.spurious).length);\n  // 0.8 for every missing;\n  var missingDeprec = Math.pow(0.8, Object.keys(a.missing).length);\n\n  // 1.1 for toolmentiond\n  if (a.toolmentioned) {\n    res *= 1.1;\n  }\n\n  var res = missingDeprec * spuriousDeprec * (weakenByN(rankingRequired * rankingOptional, 10))\n  //  var res =  matching * 100 - 30 * missing  -  10* spurious + factor;\n  debuglog(\"result is \" + res);\n  return res;\n};\n\nexport const ToolMatch = {\n  rankResult: function (a: IMatch.IToolMatchResult): number {\n    return rankToolMatch(a);\n  },\n  isAnyMatch: function (toolmatch: IMatch.IToolMatch): boolean {\n    return (Object.keys(toolmatch.toolmatchresult.required).length +\n      Object.keys(toolmatch.toolmatchresult.optional).length) > 0;\n  },\n  compBetterMatch(a: IMatch.IToolMatch, b: IMatch.IToolMatch) {\n    return rankToolMatch(b.toolmatchresult) - rankToolMatch(a.toolmatchresult);\n  },\n  isComplete: function (toolmatch: IMatch.IToolMatch) {\n    return Object.keys(toolmatch.toolmatchresult.missing).length === 0;\n  },\n\n\n  dumpNice: function (toolmatch: IMatch.IToolMatch) {\n    var result = {\n      s: \"\",\n      push: function (s) { this.s = this.s + s; }\n    };\n    var s =\n      `**Result for tool: ${toolmatch.tool.name}\n rank: ${toolmatch.rank}\n`;\n    result.push(s);\n    Object.keys(toolmatch.tool.requires).forEach(function (sRequires, index) {\n      result.push(`required: ${sRequires} -> `);\n      if (toolmatch.toolmatchresult.required[sRequires]) {\n        result.push('\"' + toolmatch.toolmatchresult.required[sRequires].matchedString + '\"');\n      } else {\n        result.push(`? missing!`);\n      }\n      result.push('\\n');\n    });\n\n    Object.keys(toolmatch.tool.optional).forEach(function (sRequires, index) {\n      result.push(`optional : ${sRequires} -> `);\n      if (toolmatch.toolmatchresult.optional[sRequires]) {\n        result.push('\"' + toolmatch.toolmatchresult.optional[sRequires].matchedString + '\"');\n      } else {\n        result.push(`?`);\n      }\n      result.push('\\n');\n    });\n    var oSentence = toolmatch.sentence;\n    oSentence.forEach(function (oWord, index) {\n      var sWord = `[${index}] : ${oWord.category} \"${oWord.string}\" => \"${oWord.matchedString}\"`\n      result.push(sWord + \"\\n\");\n    })\n    result.push(\".\\n\");\n    return result.s;\n\n  },\n\n\n  dumpWeights: function (toolmatch: IMatch.IToolMatch) {\n    var result = {\n      s: \"\",\n      push: function (s) { this.s = this.s + s; }\n    };\n\n    var requires = Object.keys(toolmatch.tool.requires).length;\n    var required = Object.keys(toolmatch.toolmatchresult.required).length;\n\n    var spurious = Object.keys(toolmatch.toolmatchresult.spurious).length;\n    var s =\n      `**Result for tool: ${toolmatch.tool.name}\n rank: ${toolmatch.rank}  (req:${required}/${requires}   ${spurious})\n`\n    result.push(s);\n    Object.keys(toolmatch.tool.requires).forEach(function (sRequires, index) {\n      result.push(`required: ${sRequires} -> `);\n      if (toolmatch.toolmatchresult.required[sRequires]) {\n        result.push('\"' + toolmatch.toolmatchresult.required[sRequires].matchedString + '\"');\n      } else {\n        result.push(`? missing!`);\n      }\n      result.push('\\n');\n    });\n\n    Object.keys(toolmatch.tool.optional).forEach(function (sRequires, index) {\n      result.push(`optional : ${sRequires} -> `);\n      if (toolmatch.toolmatchresult.optional[sRequires]) {\n        result.push('\"' + toolmatch.toolmatchresult.optional[sRequires].matchedString + '\"');\n      } else {\n        result.push(`?`);\n      }\n      result.push('\\n');\n    });\n    var oSentence = toolmatch.sentence;\n    oSentence.forEach(function (oWord, index) {\n      var sWord = `[${index}] : ${oWord.category} \"${oWord.string}\" => \"${oWord.matchedString}\"  (_r:${oWord._ranking}/${oWord.reinforce || ''}/${oWord.levenmatch || ''})`\n      result.push(sWord + \"\\n\");\n    })\n    result.push(\".\\n\");\n    return result.s;\n\n  },\n\n  dumpWeightsTop : function(toolmatches : Array<IMatch.IToolMatch>, options : any) {\n    var s = '';\n    toolmatches.forEach(function(oMatch,index) {\n      if ( index < options.top) {\n        s = s + \"Toolmatch[\" + index + \"]...\\n\";\n        s = s + ToolMatch.dumpWeights(oMatch);\n      }\n    });\n    return s;\n  }\n}\n\n\nexport const Result = {\n  getEntity: function (match: IMatch.IToolMatch, key: string): IMatch.IWord {\n    if (!match.toolmatchresult) {\n      return undefined;\n    }\n\n    if (match.toolmatchresult.required[key]) {\n      return match.toolmatchresult.required[key];\n    }\n    if (match.toolmatchresult.optional[key]) {\n      return match.toolmatchresult.optional[key];\n    }\n    return undefined;\n  }\n}"],"sourceRoot":"ABC"}