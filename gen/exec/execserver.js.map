{"version":3,"sources":["/projects/nodejs/botbuilder/fdevstart/src/../src/exec/execserver.ts"],"names":[],"mappings":"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","file":"exec/execserver.js","sourcesContent":["/**\n * Functionality to execute a certain response on the server,\n * interpreting a general model context\n *\n *\n * via a) commandline (e.g. browser startup)\n * @file\n * @copyright (c) 2016 Gerd Forstmann\n */\n\nimport * as intf from 'constants';\n\nimport * as debug from 'debug';\n\nimport *  as IFMatch from '../match/ifmatch';\n\nconst debuglog = debug('execserver')\n\nimport { exec } from 'child_process';\n\nimport * as IMatch from '../match/ifmatch';\n//import * as Match from '../match/match';\n\nimport * as Toolmatch from '../match/toolmatch';\n\nimport * as Exectemplate from './exectemplate';\n\nexport function noStar(a: string, b: string) {\n  if (b === '*') {\n    return a;\n  }\n  if (a === '*') {\n    return b;\n  }\n  if (a !== b) {\n    throw new Error('Illegal Argument no match ' + a + \" \" + b);\n  }\n  return b;\n}\n\nexport function makeGenericText(match: IMatch.IToolMatch, setId: string, record: IMatch.IRecord): string {\n  var res = \"start \" + match.tool.name;\n  var set = match.tool.sets[setId];\n  var context = Toolmatch.makeMatchSet(match, set);\n  set.set.forEach(function (category, index) {\n    var value = noStar(context[category], record[category]);\n    var prefix = \"\";\n    if (index === 0) {\n      prefix += ' using ';\n    } else if (index === set.set.length - 1) {\n      prefix += ' and ';\n    } else {\n      prefix = '; ';\n    }\n    if (category === \"category\") {\n      res = res + prefix +'\"' + value + '\"';\n    }\n    res = res + prefix + category + ' \"' + value  + '\"';\n  });\n  return res;\n}\n\nexport function execTool(match: IMatch.IToolMatch, records: IMatch.IRecord[], bExplain?: boolean ): {\n  text: string,\n  action: any\n} {\n  //\n  debuglog(\"records for match \" + JSON.stringify(match));\n  var matchSetRecord = Toolmatch.findFirstSetRecord(match, records);\n  if(!matchSetRecord) {\n    return {\n      text : \"cannot start\",\n      action: {}\n    }\n  };\n  var set = match.tool.sets[matchSetRecord.setId];\n  var pattern = matchSetRecord.record[set.response];\n\n  var context = Toolmatch.makeMatchSet(match, set);\n  var url = Exectemplate.expandTemplate(context, pattern);\n  var text = \"\";\n  debuglog(\"record \" +JSON.stringify(\"matchSetRecord \"));\n  var patternText = matchSetRecord.record[\"_text\" + set.response];\n  if (patternText) {\n    text = Exectemplate.expandTemplate(context, patternText);\n  } else {\n    text = makeGenericText(match, matchSetRecord.setId, matchSetRecord.record)\n  }\n  return {\n    text: text,\n    action: { url: url }\n  }\n}\n"],"sourceRoot":"ABC"}