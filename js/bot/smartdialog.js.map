{"version":3,"sources":["/projects/nodejs/botbuilder/mgnlq_abot/src/../src/bot/smartdialog.ts"],"names":[],"mappings":"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","file":"smartdialog.js","sourcesContent":["/**\n * The bot implementation\n *\n * Instantiate apssing a connector via\n * makeBot\n *\n *\n */\n/**\n * @file\n * @module jfseb.mgnlq_abot.smartdialog\n * @copyright (c) 2016-2109 Gerd Forstmann\n */\n\nimport * as fs from 'fs';\n\nimport * as builder from 'botbuilder';\nimport * as debug from 'debug';\n\n//import * as Match from '../match/match';\nimport * as mongoose from 'mongoose';\n\n//import * as Analyze from '../match/analyze';\nimport { BreakDown } from 'mgnlq_model';\n\nimport * as WhatIs from '../match/whatis';\nimport * as ListAll from '../match/listall';\nimport * as Describe from '../match/describe';\nimport * as MakeTable from '../exec/makeqbetable';\nimport * as MongoQueries from '../match/mongoqueries';\n\nimport * as Utils from 'abot_utils';\n\nimport { ErError as ErError } from 'mgnlq_parser1';\n\nimport * as _ from 'lodash';\n\nimport * as DialogLogger from '../utils/dialoglogger';\n\nimport { MongoQ as MongoQ } from 'mgnlq_parser1';\n\nimport * as process from 'process';\n\nvar dburl = process.env.DATABASE_URL || \"\";\n\nvar pglocalurl = \"postgres://joe:abcdef@localhost:5432/abot\";\nvar dburl = process.env.DATABASE_URL || pglocalurl;\nimport * as pg from 'pg';\nvar o = pg as any;\nif (!(process.env.ABOT_DBNOSSL)) {\n  o.defaults.ssl = true; // Only used internally !\n}\nvar dialogLogger = DialogLogger.logger(\"smartbot\", dburl, pg);\n\ntype stringOrMessage = string | builder.Message;\nfunction send<T extends stringOrMessage>(o: T): T { return o; };\nfunction dialoglog(intent: string, session: builder.Session, response: stringOrMessage) {\n  var sResponse: string;\n  var sAction: string;\n  if (typeof response === \"string\") {\n    sAction = \"\";\n    sResponse = response;\n  } else {\n    var aMessage: builder.Message = response;\n    var iMessage: builder.IMessage = aMessage.toMessage();\n    sResponse = iMessage.text;\n    sAction = (iMessage.entities && iMessage.entities[0]) ? (JSON.stringify(iMessage.entities && iMessage.entities[0])) : \"\";\n  }\n  dialogLogger({\n    intent: intent,\n    session: session,\n    response: sResponse,\n    action: sAction\n  });\n  session.send(response);\n}\n\nvar elizabot = require('../extern/elizabot/elizabot.js');\n//import * as elizabot from 'elizabot';\n\nlet debuglog = debug('smartdialog');\nimport * as PlainRecognizer from './plainrecognizer';\n//var builder = require('botbuilder');\n\nfunction getConversationId(session: builder.Session): string {\n  return session.message &&\n    session.message.address &&\n    session.message.address.conversation.id;\n}\n\nvar elizabots = {};\n\nfunction getElizaBot(id: string) {\n  if (!elizabots[id]) {\n    elizabots[id] = {\n      access: new Date(),\n      elizabot: new elizabot()\n    };\n  }\n  elizabots[id].access = new Date();\n  return elizabots[id].elizabot;\n}\n\nimport * as IMatch from '../match/ifmatch';\n//import * as Tools from '../match/tools';\n\nvar newFlow = true;\n\nimport { Model } from 'mgnlq_model';\n\nvar models = {};\n\n/*\nvar mongooseMock = require('mongoose_record_replay').instrumentMongoose(require('mongoose'),\n  'node_modules/mgnlq_testmodel_replay/mgrecrep/',\n  'REPLAY');\n\n\nfunction loadModel(modelPath?: string): Promise<IMatch.IModels> {\n  modelPath = modelPath || \"\";\n  if (!models[modelPath])\n    models[modelPath] = Model.loadModels(mongooseMock, modelPath);\n  }\n  return models[modelPath];\n}\n*/\n\n\n\nfunction isAnonymous(userid: string): boolean {\n  return userid.indexOf(\"ano:\") === 0;\n}\n\nexport function restrictData(arr: any[]): any[] {\n  if (arr.length < 6) {\n    return arr;\n  }\n  var len = arr.length;\n  var res = arr.slice(0, Math.min(Math.max(Math.floor(arr.length / 3), 7), arr.length));\n  if (typeof arr[0] === \"string\") {\n    var delta = len - res.length;\n    res.push(\"... and \" + delta + \" more entries for registered users\");\n  }\n  return res;\n}\n\nfunction restrictLoggedOn(session: builder.Session, arr: any[]): any[] {\n  var userid = session.message.address\n    && session.message.address.user\n    && session.message.address.user.id || \"\";\n  if (process.env.ABOT_EMAIL_USER && isAnonymous(userid)) {\n    return restrictData(arr);\n  }\n  return arr;\n}\n\nconst aTrainReplies = [\"Thank you for sharing this suggestion with us\",\n  \"Thank for for this valuable information.\",\n  \"Thank for for this interesting fact!\",\n  \"Thats a plethoria of information.\",\n  \"That's a nugget of information.\",\n  \"Lovely, I may consider you input.\",\n  \"Well done, anything more to let me know?\",\n  \"I do appreciate your teaching and my learning experience, or was it the other way round?\",\n  \"Your helpful input has been stored in some dusty corner of the World wide web!\",\n  \"Thank you for my learning experience!\",\n  \"I have incorporated your valuable suggestion in the wisdom of the internet\"\n];\n\nvar aTrainDialog = aTrainReplies;\n\nvar aTrainExitHint = [\n  \"\\ntype \\\"done\\\" when you are done training me.\",\n  \"\",\n  \"\",\n  \"\",\n  \"\\nremember, you are stuck here instructing me, type \\\"done\\\" to return.\",\n  \"\"];\n\nconst aEnterTrain = ['So you think this is wrong? You can offer your advise here.\\n Type \"done\" if you are done with instructing me',\n  'Feel free to offer me your better solution here.\\nType \"done\" if you are done with instructing me',\n  'Some say \"The secret to happiness is to lower your expectations to the point they are already met.\", \\nt if you could help me to become better, instruct me.\\n Type \"done\" if you are done with teaching me',\n  'Feel free to offer me your better solution here.\\n Type \"done\" if you are done with instructing me',\n  'Feel free to offer me your better solution here.\\n Type \"done\" if you are done with instructing me',\n];\nconst aBackFromTraining = [\n  'Puuh, back from training! Now for the easy part ...\\n ask me a new question.',\n  'Live and don\\'t learn, that\\'s us. Naah, we\\'ll see.\\nAsk me another question.',\n  'The secret to happiness is to lower your expectations to the point they are already met.\\n Ask me a question.',\n  'Thanks for having this lecture session, now i am back to our usual self.\\n Ask me a question.'\n];\n\n\nconst aTrainNoKlingon = [\n  \"He who masters the dark arts of SAP must not dwell in the earthly realms of Star Trek.\",\n  \"SAP is a cloud company, not a space company.\",\n  \"The depth of R/3 are deeper than Deep Space 42.\",\n  \"My brainpower is fully absorbed with mastering other realms.\",\n  \"For the wosap, the sky is the limit. Feel free to check out nasa.gov .\",\n  \"The future is SAP or IBM blue, not space black.\",\n  \"That's left to some murky future.\"\n]\n\nexport const aResponsesOnTooLong = [\n  \"Your input should be eloquent in it's brevity. This one was too long.\",\n  \"my wisdom is severly bound by my limited input processing capabilities. Could you formulate a shorter input? Thank you.\",\n  \"The length of you input indicates you probably know more about the topic than me? Can i humbly ask you to formulate a shorter question?\",\n  '\\\"What ever you want to teach, be brief\\\" (Horace). While this does not always applies to my answers, it is require for your questions. Please try again with a refined questions.',\n  'I understand more than 4-letter words, but not more than 20 word sentences. Please try to shorten your input.',\n  'the sky is the limit? Air force member or not, you can ask longer questions than \\\"the sky\\\", but not this long',\n  'My answers may be exhaustive, but I understand more than 4-letter words, but not more than 20 word sentences. Sorry.',\n  'Our conversation must be highly assymmetric: my answers may be verbose and exhaustive and fuzzy, questions and input must be brief. Try to reformulate it',\n];\n\nexport const metawordsDescriptions = {\n  \"category\": \"an attribute of a record in a model, example: a Planet has a \\\"name\\\" attribute\",\n  \"domain\": \"a group of facts which are typically unrelated\",\n  \"key\": \"an attribute value (of a category) which  is unique for the record\",\n  \"tool\": \"is potentialy command to execute\",\n  \"record\": \"a specific set of \\\"fact\\\"s of a domain, a \\\"record\\\" has a set of attributes values (\\\"fact\\\"s) of the categories, often a record has a \\\"key\\\"\",\n  \"fact\": \"a specific category value of a record in a domain, may be a \\\"key\\\" value\",\n};\n\nfunction getRandomResult(arr: string[]): string {\n  return arr[Math.floor(Math.random() * arr.length) % arr.length];\n}\n\nexport class SimpleUpDownRecognizer implements builder.IIntentRecognizer {\n  constructor() {\n\n  }\n\n  recognize(context: builder.IRecognizeContext, callback: (err: Error, result: builder.IIntentRecognizerResult) => void): void {\n    var u = {} as builder.IIntentRecognizerResult;\n\n    debuglog(\"recognizing \" + context.message.text);\n    if (context.message.text.indexOf(\"down\") >= 0) {\n      u.intent = \"intent.down\";\n      u.score = 0.9;\n      var e1 = {} as builder.IEntity;\n      e1.startIndex = \"start \".length;\n      e1.endIndex = context.message.text.length;\n      e1.score = 0.3;\n      u.entities = [e1];\n      callback(undefined, u);\n      return;\n    }\n    if (context.message.text.indexOf(\"up\") >= 0) {\n      u.intent = \"intent.up\";\n      u.score = 0.9;\n      var e1 = {} as builder.IEntity;\n      e1.startIndex = \"up\".length;\n      e1.endIndex = context.message.text.length;\n      e1.score = 0.3;\n      u.entities = [e1];\n      callback(undefined, u);\n      return;\n    }\n    if (context.message.text.indexOf(\"done\") >= 0) {\n      u.intent = \"intent.up\";\n      u.score = 0.9;\n      var e1 = {} as builder.IEntity;\n      e1.startIndex = \"up\".length;\n      e1.endIndex = context.message.text.length;\n      e1.score = 0.3;\n      u.entities = [e1];\n      callback(undefined, u);\n      return;\n    }\n    if (context.message.text.indexOf(\"exit\") >= 0) {\n      u.intent = \"intent.up\";\n      u.score = 0.9;\n      var e1 = {} as builder.IEntity;\n      e1.startIndex = \"up\".length;\n      e1.endIndex = context.message.text.length;\n      e1.score = 0.3;\n      u.entities = [e1];\n      callback(undefined, u);\n      return;\n    }\n    if (context.message.text.indexOf(\"quit\") >= 0) {\n      u.intent = \"intent.up\";\n      u.score = 0.9;\n      var e1 = {} as builder.IEntity;\n      e1.startIndex = \"up\".length;\n      e1.endIndex = context.message.text.length;\n      e1.score = 0.3;\n      u.entities = [e1];\n      callback(undefined, u);\n      return;\n    }\n    debuglog('recognizing nothing');\n    u.intent = \"None\";\n    u.score = 0.1;\n    var e1 = {} as builder.IEntity;\n    e1.startIndex = \"exit \".length;\n    e1.endIndex = context.message.text.length;\n    e1.score = 0.1;\n    u.entities = [];\n    callback(undefined, u);\n  }\n}\n\nconst AnyObject = Object as any;\n\nvar bot;\n\nvar oJSON = JSON.parse('' + fs.readFileSync('./resources/model/intents.json'));\nvar oRules = PlainRecognizer.parseRules(oJSON);\n// var Recognizer = new (recognizer.RegExpRecognizer)(oRules);\n\n\nfunction logQuery(session: builder.Session, intent: string, result?: Array<any>) {\n\n  fs.appendFile('./logs/showmequeries.txt', \"\\n\" + JSON.stringify({\n    text: session.message.text,\n    timestamp: session.message.timestamp,\n    intent: intent,\n    res: result && result.length && JSON.stringify(result[0]) || \"0\",\n    conversationId: session.message.address\n    && session.message.address.conversation\n    && session.message.address.conversation.id || \"\",\n    userid: session.message.address\n    && session.message.address.user\n    && session.message.address.user.id || \"\"\n  }) , function (err) {\n    if (err) {\n      debuglog(\"logging failed \" + err);\n    }\n  });\n}\n\n/*\n\nfunction logQueryWhatIs(session: builder.Session, intent: string, result?: Array<IMatch.IWhatIsAnswer>) {\n\n  fs.appendFile('./logs/showmequeries.txt', \"\\n\" + JSON.stringify({\n    text: session.message.text,\n    timestamp: session.message.timestamp,\n    intent: intent,\n    res: result && result.length && WhatIs.dumpNice(result[0]) || \"0\",\n    conversationId: session.message.address\n    && session.message.address.conversation\n    && session.message.address.conversation.id || \"\",\n    userid: session.message.address\n    && session.message.address.user\n    && session.message.address.user.id || \"\"\n  }), function (err, res) {\n    if (err) {\n      debuglog(\"logging failed \" + err);\n    }\n  });\n}\n*/\n\nfunction logQueryWhatIsTupel(session: builder.Session, intent: string, result?: Array<IMatch.IWhatIsTupelAnswer>) {\n\n  fs.appendFile('./logs/showmequeries.txt', \"\\n\" + JSON.stringify({\n    text: session.message.text,\n    timestamp: session.message.timestamp,\n    intent: intent,\n    res: result && result.length && WhatIs.dumpNiceTupel(result[0]) || \"0\",\n    conversationId: session.message.address\n    && session.message.address.conversation\n    && session.message.address.conversation.id || \"\",\n    userid: session.message.address\n    && session.message.address.user\n    && session.message.address.user.id || \"\"\n  }), function (err) {\n    if (err) {\n      debuglog(\"logging failed \" + err);\n    }\n  });\n}\n\nvar gwords = {};\n/**\n * Construct a bot\n * @param connector {Connector} the connector to use\n * HTMLConnector\n * or connector = new builder.ConsoleConnector().listen()\n */\nfunction makeBot(connector,\n  modelProvider: () => Promise<IMatch.IModels>, options?: any): builder.UniversalBot {\n  var t0 = Date.now();\n  var theModelP = modelProvider();\n  theModelP.then(\n    (theModel) => {\n      var t = Date.now() - t0;\n      if (options && options.showModelLoadTime) {\n        console.log(`model load time ${(t)}`);\n      }\n    });\n\n  function getTheModel(): Promise<IMatch.IModels> {\n    return theModelP;\n  }\n\n  bot = new builder.UniversalBot(connector);\n\n\n\n  // Create LUIS recognizer that points at our model and add it as the root '/' dialog for our Cortana Bot.\n  // var model = sensitive.modelurl;\n  // var model = 'https://api.projectoxford.ai/luis/v2.0/apps/c413b2ef-382c-45bd-8ff0-f76d60e2a821?subscription-key=c21398b5980a4ce09f474bbfee93b892&q='\n  var recognizer = new PlainRecognizer.RegExpRecognizer(oRules);\n\n  var dialog = new builder.IntentDialog({ recognizers: [recognizer] });\n  // dialog.onBegin(function(session,args) {\n  // console.log(\"beginning ...\")\n  // session.dialogData.retryPrompt = args && args.retryPrompt || \"I am sorry\"\n  // session.send(\"What do you want?\")\n  //\n  // })\n\n  var dialogUpDown = new builder.IntentDialog({ recognizers: [new SimpleUpDownRecognizer()] });\n\n  bot.dialog('/updown', dialogUpDown);\n  dialogUpDown.onBegin(function (session) {\n    dialoglog(\"TrainMe\", session, send(getRandomResult(aEnterTrain)));\n    //session.send(\"Hi there, updown is waiting for you\");\n  })\n\n  dialogUpDown.matches('intent.up', [\n    function (session, args, next) {\n      session.dialogData.abc = args || {};\n      builder.Prompts.text(session, 'you want to exit training? type \\\"done\\\" again.');\n    },\n    function (session, results, next) {\n      session.dialogData.abc = results.reponse;\n      next();\n    },\n    function (session, results) {\n      session.endDialogWithResult({ response: session.dialogData.abc });\n    }\n  ]\n  );\n\n  dialogUpDown.matches('intent.down', [\n    function (session, args, next) {\n      session.dialogData.abc = args || {};\n      builder.Prompts.text(session, 'you want to go down!');\n    },\n    function (session, results, next) {\n      session.dialogData.abc = -1; // results.reponse;\n      next();\n    },\n    function (session, results) {\n      session.send(\"still going down?\");\n    }\n  ]\n  );\n  dialogUpDown.onDefault(function (session) {\n    logQuery(session, \"onDefault\");\n    var res = getRandomResult(aTrainDialog) + getRandomResult(aTrainExitHint);\n    dialoglog(\"TrainMe\", session, send(res));\n  });\n\n  /*\n    bot.dialog('/train', [\n      function (session, args, next) {\n        session.dialgoData.abc = args || {};\n        builder.Prompts.text(session, 'Do you want to train me');\n      },\n      function (session, results, next) {\n        session.dialogData.abc = results.reponse;\n      },\n      function (session, results) {\n        session.endDialogWithResult({ response: session.DialogData.abc });\n      }\n    ]);\n  */\n\n  bot.dialog('/', dialog);\n\n  dialog.matches('ShowMe', [\n    function (session, args, next) {\n      var isCombinedIndex = {};\n      var oNewEntity;\n      // ShowMe is a special form of WhatIs which also selects teh\n      // \"closest _url\" ranked by _preferredUrlOrder\n      // if present, the _url is put into exec.action\n\n      //\n      /// TODO REMODEL\n      // expecting entity A1\n      debuglog(\"Show Entity\");\n      debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);\n      var a1 = builder.EntityRecognizer.findEntity(args.entities, 'A1');\n      getTheModel().then((theModel) => {\n        ListAll.listAllShowMe(a1.entity, theModel).then(\n          resultShowMe => {\n            logQuery(session, 'ShowMe', (resultShowMe as any).bestURI);\n            // test.expect(3)\n            //  test.deepEqual(result.weight, 120, 'correct weight');\n            if (!resultShowMe || !(resultShowMe as any).bestURI) {\n              dialoglog(\"ShowMe\", session, send(\"I did not get what you want\"));\n              return;\n            }\n            var bestURI = (resultShowMe as any).bestURI;\n            // debuglog('result : ' + JSON.stringify(result, undefined, 2));\n            debuglog('best result : ' + JSON.stringify(resultShowMe || {}, undefined, 2));\n\n            // text : \"starting unit test \\\"\" + unittest + \"\\\"\"+  (url?  (' with url ' + url ) : 'no url :-(' ),\n            //      action : { url: url }\n\n            var reply = new builder.Message(session)\n              .text(\"starting uri \" + bestURI)\n              .addEntity({ url: bestURI }) // exec.action);\n            // .addAttachment({ fallbackText: \"I don't know\", contentType: 'image/jpeg', contentUrl: \"www.wombat.org\" });\n            dialoglog(\"ShowMe\", session, send(reply));\n          });\n      });\n    },\n  ]);\n\n  dialog.matches('WhatIs', [\n    function (session, args, next) {\n      var isCombinedIndex = {};\n      var oNewEntity;\n      // expecting entity A1\n      var message = session.message.text;\n\n      // TODO SWITH TO MONGOQUERIES\n      getTheModel().then((theModel) => {\n\n        debuglog(\"WhatIs Entities\");\n        debuglog(debuglog.enabled ? ('raw: ' + JSON.stringify(args.entities, undefined, 2)) : '-');\n        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'category');\n        var categoriesjoined = categoryEntity.entity;\n        var inSth = builder.EntityRecognizer.findEntity(args.entities, 'A1');\n        var cats = [];\n        try {\n          cats = WhatIs.analyzeCategoryMultOnlyAndComma(categoriesjoined, theModel.rules, message);\n          debuglog(\"here cats: \" + cats.join(\",\"));\n        } catch (e) {\n          if (e) {\n            debuglog(\"here exception\" + e);\n            // currently we do not extract categories correctly , thus we rather ignore and go on\n            //just go on   dialoglog(\"WhatIs\", session, send('I don\\'t know anything about \"' + categoriesjoined +\n            //     (e ? '(' + e.toString() + ')' : \"\")));\n            //   // next();\n            //   return;\n          }\n        }\n        //console.log(JSON.stringify(theModel.rules.wordMap['co-fio']));\n        var query = categoriesjoined;\n        var inSomething = inSth && inSth.entity || \"\";\n        if (inSth) {\n          query = categoriesjoined + ' with ' + inSth.entity;\n        }\n        MongoQueries.listAll(query, theModel).then(resultWI => {\n          debuglog(() => 'got result' + JSON.stringify(resultWI))\n\n          var err_explain = ListAll.returnErrorTextIfOnlyError(resultWI);\n          if (err_explain) {\n            //dialoglog(\"ListAll\", session, send('I don\\'t know anything about \"' + cat + \" (\" + category + ')\\\" in relation to \"' + a1.entity + `\".${explain}`));\n            // next();\n            dialoglog(\"ListAll\", session, send('I don\\'t know anything about \"' + categoriesjoined + \"\\\" (\" + Utils.listToQuotedCommaAnd(cats) + ') in relation to \"' + inSth.entity + `\".${err_explain}`));\n            return;\n\n            //  dialoglog(\"ListAll\", session, send(err_text));\n            //  return;\n          }\n          var joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(resultWI));\n          logQueryWhatIsTupel(session, 'ListAll', resultWI);\n          debuglog(debuglog ? ('listall result2 >:' + JSON.stringify(resultWI)) : '-');\n          // debuglog('result : ' + JSON.stringify(result, undefined, 2));\n          debuglog(debuglog.enabled ? ('best result : ' + JSON.stringify(resultWI[0].results[0] || {}, undefined, 2)) : '-');\n          // debuglog(debuglog.enabled? ('top : ' + WhatIs.dumpWeightsTop(result1.tupelanswers[0].result[0] || {}, { top: 3 })): '-');\n          // TODO cleansed sentence\n\n          //dialoglog(\"WhatIs\", session, send('The ' + categoriesjoined + ' of ' + inSth.entity + ' is ' +\n          //resultWI.tupelanswers[0].result + \"\\n\"));\n\n\n          debuglog(debuglog ? ('listall result >:' + JSON.stringify(resultWI)) : '-');\n          // TODO Why only FIRST!???\n          var joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel([resultWI[0]]));\n          logQueryWhatIsTupel(session, 'ListAll', resultWI);\n          debuglog(debuglog ? ('listall result2 >:' + JSON.stringify(resultWI)) : '-');\n          if (joinresults.length) {\n            var suffix = inSomething ? ' of ' + inSomething : '';\n            if (cats.length === 1) {\n              dialoglog(\"WhatIs\", session, send('The ' + categoriesjoined + suffix + ' is ' +\n                joinresults + \"\\n\"));\n            } else {\n              dialoglog(\"WhatIs\", session, send(\"The \" + categoriesjoined + suffix + \" are ...\\n\" + joinresults.join(\";\\n\")));\n            }\n          } else {\n            var errprefix = ListAll.returnErrorTextIfOnlyError(resultWI) || '';\n            var suffix2 = inSomething ? ' for ' + inSomething : '';\n            dialoglog(\"ListAll\", session, send(\"i did not find any \" + categoriesjoined + suffix2 + \".\\n\" + joinresults.join(\";\\n\") + \"\" + errprefix));\n          }\n          return;\n        });\n        return;\n      });\n    }\n  ]);\n\n  dialog.matches('ListAll', [\n    function (session, args, next) {\n      var isCombinedIndex = {};\n      var oNewEntity;\n      // expecting entity A1\n      var message = session.message.text;\n      debuglog(\"Intent : ListAll\");\n      debuglog(debuglog.enabled ? ('raw: ' + JSON.stringify(args.entities, undefined, 2)) : '-');\n      var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'categories');\n      var category = categoryEntity.entity;\n      var inSthEntity = builder.EntityRecognizer.findEntity(args.entities, 'insth')\n      var inSomething = inSthEntity && inSthEntity.entity;\n      // some metaqueries:\n      getTheModel().then((theModel) => {\n\n        if (category === \"categories\") {\n          // do we have a filter ?\n          var domain = undefined;\n          if (inSomething) {\n            domain = ListAll.inferDomain(theModel, inSomething);\n          }\n          if (!domain) {\n            var res = restrictLoggedOn(session, theModel.category).join(\";\\n\");\n            if (inSomething) {\n              dialoglog(\"ListAll\", session, send(\"I did not infer a domain restriction from \\\"\" + Utils.stripQuotes(inSomething) + \"\\\", all my categories are ...\\n\" + res));\n            } else {\n              dialoglog(\"ListAll\", session, send(\"my categories are ...\\n\" + res));\n            }\n            return;\n          } else {\n            var aRes = Model.getCategoriesForDomain(theModel, domain);\n            var res = restrictLoggedOn(session, aRes).join(\";\\n\");\n            dialoglog(\"ListAll\", session, send(\"my categories in domain \\\"\" + domain + \"\\\" are ...\\n\" + res));\n            return;\n          }\n        }\n        if (category === \"domains\") {\n          var res = restrictLoggedOn(session, theModel.domains).join(\";\\n\");\n          dialoglog(\"ListAll\", session, send(\"my domains are ...\\n\" + res));\n          return;\n        }\n        //console.log(JSON.stringify(theModel.rules.wordMap['co-fio']));\n        var query = category;\n        var categoriesjoined = category;\n        if (inSomething) {\n          query = category + ' with ' + inSomething;\n        }\n        MongoQueries.listAll(query, theModel).then(result1 => {\n          var cats = [];\n          try {\n            debuglog('analyzing category from ' + category);\n            cats = WhatIs.analyzeCategoryMultOnlyAndComma(category, theModel.rules, message);\n            debuglog(\"here cats: \" + cats.join(\",\"));\n          } catch (e) {\n            if (e) {\n              debuglog(\"here exception: \" + e);\n              // Go on for now\n              //\n\n              //  dialoglog(\"WhatIs\", session, send('I don\\'t know anything about \"' + category +\n              //    (e ? '(' + e.toString() + ')' : \"\")));\n              //  // next();\n              //  return;\n            }\n          }\n          //var result1 = ListAll.listAllWithContext(cat, inSomething,\n          //  theModel.rules, theModel.records, categorySet);\n          debuglog(debuglog ? ('listall result >:' + JSON.stringify(result1)) : '-');\n          var err_explain = ListAll.returnErrorTextIfOnlyError(result1);\n          if (err_explain) {\n            //dialoglog(\"ListAll\", session, send('I don\\'t know anything about \"' + cat + \" (\" + category + ')\\\" in relation to \"' + a1.entity + `\".${explain}`));\n            // next();\n            var suffix = inSomething ? 'in relation to \"' + inSomething + '\"' : '';\n            dialoglog(\"ListAll\", session, send('I don\\'t know anything about \"' + categoriesjoined + \"\\\" (\" + Utils.listToQuotedCommaAnd(cats) + ')' + suffix + `.${err_explain}`));\n            return;\n\n            //  dialoglog(\"ListAll\", session, send(err_text));\n            //  return;\n          }\n          var joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(result1));\n          logQueryWhatIsTupel(session, 'ListAll', result1);\n          debuglog(() => ('listall result2 >:' + JSON.stringify(result1)));\n          var suffix = (inSomething) ? \" for \" + inSomething : \"\";\n          if (joinresults.length) {\n            dialoglog(\"ListAll\", session, send(\"the \" + category + suffix + \" are ...\\n\" + joinresults.join(\";\\n\")));\n          } else {\n            var errprefix = \"\";\n            var errprefix = ListAll.returnErrorTextIfOnlyError(result1) || '';\n            dialoglog(\"ListAll\", session, send(\"I did not find any \" + category + suffix + \".\\n\" + joinresults.join(\";\\n\") + \"\" + errprefix));\n          }\n          return;\n        });\n        return;\n      });\n    }\n  ]);\n\n\n  dialog.matches('buildtable', [\n    function (session, args, next) {\n      var isCombinedIndex = {};\n      var oNewEntity;\n      // expecting entity A1\n      getTheModel().then((theModel) => {\n\n        var message = session.message.text;\n        debuglog(\"Intent : buildtable\");\n        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);\n        var categories = builder.EntityRecognizer.findEntity(args.entities, 'categories').entity;\n        debuglog(\"factOrCat is\" + categories);\n        var cats;\n        try {\n          cats = WhatIs.analyzeCategoryMultOnlyAndComma(categories, theModel.rules, message);\n          debuglog(\"here cats\" + cats.join(\",\"));\n        } catch (e) {\n          if (e) {\n            debuglog(\"here exception\" + e);\n            dialoglog(\"WhatIs\", session, send('I don\\'t know anything about \"' + categories + '\"(' + e.toString() + ')'));\n            // next();\n            return;\n          }\n        }\n        if (!cats || (cats.length === 0)) {\n          dialoglog(\"ListAll\", session, send('I did not find a category in \"' + categories + '\"'));\n          // next();\n          return;\n        }\n        var exec = MakeTable.makeTable(cats, theModel);\n        //      const exec = ExecServer.execTool(session.dialogData.result as IMatch.IToolMatch, theModel.records);\n        var reply = new builder.Message(session)\n          .text(exec.text)\n          .addEntity(exec.action);\n        // .addAttachment({ fallbackText: \"I don't know\", contentType: 'image/jpeg', contentUrl: \"www.wombat.org\" });\n        dialoglog(\"ShowMe\", session, send(reply));\n      });\n    }\n\n\n  ]);\n\n  dialog.matches('Describe', [\n    function (session, args, next) {\n      var isCombinedIndex = {};\n      var oNewEntity;\n      // expecting entity A1\n      getTheModel().then((theModel) => {\n        var message = session.message.text;\n        debuglog(\"Intent : Describe\");\n        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);\n        var factEntity = builder.EntityRecognizer.findEntity(args.entities, 'A1');\n        var factOrCat = factEntity && factEntity.entity;\n        var domainEntity = builder.EntityRecognizer.findEntity(args.entities, 'D');\n        var domainS = domainEntity && domainEntity.entity;\n        var filterDomain = undefined;\n        if (domainS) {\n          filterDomain = ListAll.inferDomain(theModel, domainS);\n          debuglog(\"got domain\" + filterDomain);\n          if (!filterDomain) {\n            dialoglog(\"Describe\", session, send(\"I did not infer a domain restriction from \\\"\" + domainS + \"\\\". Specify an existing domain. (List all domains) to get exact names.\\n\"));\n            return;\n          }\n        }\n\n        debuglog(\"factOrCat is\" + factOrCat);\n        if (metawordsDescriptions[factOrCat.toLowerCase()]) {\n          // do we have a filter ?\n          var prefix = \"\";\n          if (filterDomain) {\n            prefix = '\"in domain \"' + filterDomain + '\" make no sense when matching a metaword.\\n';\n          }\n          debuglog(\"showing meta result\");\n          dialoglog(\"Describe\", session, send(prefix + '\"' + factOrCat + '\" is ' + metawordsDescriptions[factOrCat.toLowerCase()] + \"\"));\n          return;\n        }\n        var categories = [];\n        if (WhatIs.splitAtCommaAnd(factOrCat).length > 1) {\n          dialoglog(\"Describe\", session, send(\"Whoa, i can only explain one thing at a time, not \\\"\" + factOrCat + \"\\\". Please ask one at a time.\"));\n          return;\n          // getDomainsForCategory\n        }\n\n\n\n        var category = WhatIs.analyzeCategory(factOrCat, theModel.rules, message);\n        //var catResults = [];\n        var catResultsP = undefined as Promise<string[]>;\n        if (category) {\n          //TODO\n          catResultsP = Describe.describeCategory(category, filterDomain, theModel, message);\n        } else {\n          catResultsP = (global.Promise as any).resolve([]);\n        }\n\n        catResultsP.then(catResults => {\n          var resFact = Describe.describeFactInDomain(factOrCat, filterDomain, theModel).then((resFact) => {\n\n            if (catResults) {\n              var prefixed = catResults.map(res =>\n                `${Describe.sloppyOrExact(category, factOrCat, theModel)}  ${res}`);\n            }\n            if (catResults.length) {\n              resFact = prefixed.join(\"\\n\"); + \"\\n\" + resFact;\n            }\n            dialoglog(\"Describe\", session, send(resFact));\n          });\n          /*\n              var aRes = Model.getCategoriesForDomain(theModel, domain);\n               var res = restrictLoggedOn(session, aRes).join(\";\\n\");\n              dialoglog(\"ListAll\",session,send(\"my categories in domain \\\"\" + domain + \"\\\" are ...\\n\" + res));\n              return;\n            }\n          }\n          if (category === \"domains\") {\n            var res = restrictLoggedOn(session, theModel.domains).join(\";\\n\");\n            dialoglog(\"ListAll\",session, send(\"my domains are ...\\n\" + res));\n            return;\n          }\n          if (category === \"tools\") {\n            var res = restrictLoggedOn(session, theModel.tools).map(function (oTool) {\n              return oTool.name;\n            }).join(\";\\n\");\n            dialoglog(\"ListAll\", session,send(\"my tools are ...\\n\" + res));\n            return;\n          }\n          */\n\n          /*\n          var cats = [];\n            try {\n            cats = WhatIs.analyzeCategoryMult2(category, theModel.rules, message);\n            debuglog(\"here cats\" + cats.join(\",\"));\n          } catch (e) {\n              if(e) {\n                debuglog(\"here exception\" + e);\n                dialoglog(\"WhatIs\",session,send('I don\\'t know anything about \"' + category + '\"(' + e.toString() + ')'));\n                // next();\n                return;\n              }\n          }\n          if (!cats || (cats.length === 0)) {\n            dialoglog(\"ListAll\",session,send('I don\\'t know anything about \"' + category + '\"'));\n            // next();\n            return;\n          }\n          var cat = \"\";\n          if( cats.length === 1) {\n            cat = cats[0];\n          }\n          if( cats.length === 1) {\n            debuglog('category identified:' + cat);\n            if (a1 && a1.entity) {\n              debuglog('got filter:' + a1.entity);\n              var categorySet = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, true);\n              var result1 = ListAll.listAllWithContext(cat, a1.entity,\n                theModel.rules, theModel.records, categorySet);\n              // TODO classifying the string twice is a terrible waste\n              if (!result1.length) {\n                debuglog('going for having');\n                var categorySetFull = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, false);\n                result1 = ListAll.listAllHavingContext(cat, a1.entity, theModel.rules,\n                  theModel.records, categorySetFull);\n              }\n              debuglog('listall result:' + JSON.stringify(result1));\n              var joinresults = restrictLoggedOn(session, ListAll.joinResults(result1));\n              logQueryWhatIs(session, 'ListAll', result1);\n              if(joinresults.length ){\n                dialoglog(\"ListAll\",session,send(\"the \" + category + \" for \" + a1.entity + \" are ...\\n\" + joinresults.join(\";\\n\")));\n              } else {\n                dialoglog(\"ListAll\",session,send(\"i did not find any \" + category + \" for \" + a1.entity + \".\\n\" + joinresults.join(\";\\n\")));\n              }\n              return;\n            } else {\n              // no entity, e.g. list all countries\n              //\n              var categorySetFull = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, false);\n              var result = ListAll.listAllHavingContext(cat, cat, theModel.rules, theModel.records, categorySetFull);\n              logQueryWhatIs(session, 'ListAll', result);\n              if (result.length) {\n                debuglog('listall result:' + JSON.stringify(result));\n                var joinresults = [];\n                debuglog(\"here is cat>\" + cat);\n                if(cat !== \"example question\") {\n                  joinresults = restrictLoggedOn(session, ListAll.joinResults(result));\n                } else {\n                  joinresults = ListAll.joinResults(result);\n                }\n                var response = \"the \" + category + \" are ...\\n\" + joinresults.join(\";\\n\");\n                dialoglog(\"ListAll\",session,send(response));\n                return;\n              } else {\n                var response = \"Found no data having \\\"\" + cat + \"\\\"\"\n                dialoglog(\"ListAll\",session,send(response));\n                return;\n              }\n            }\n          } else {\n            // multiple categories\n            debuglog('categories identified:' + cats.join(\",\"));\n            if (a1 && a1.entity) {\n              debuglog('got filter:' + a1.entity);\n              try {\n              var categorySet = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, true);\n              } catch(e) {\n                  debuglog(\"here exception\" + e);\n                  dialoglog(\"WhatIs\",session,send('I cannot combine \"' + category + '(' + e.toString() + ')'));\n                  return;\n              }\n              var result1T = ListAll.listAllTupelWithContext(cats, a1.entity,\n                theModel.rules, theModel.records, categorySet);\n              // TODO classifying the string twice is a terrible waste\n              if (!result1T.length) {\n                debuglog('going for having');\n                var categorySetFull = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, false);\n                result1T = ListAll.listAllTupelHavingContext(cats, a1.entity, theModel.rules,\n                  theModel.records, categorySetFull);\n              }\n              debuglog('listall result:' + JSON.stringify(result1T));\n              var joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(result1T));\n              logQueryWhatIsTupel(session, 'ListAll', result1T);\n              if(joinresults.length ){\n                dialoglog(\"ListAll\",session,send(\"the \" + category + \" for \" + a1.entity + \" are ...\\n\" + joinresults.join(\";\\n\")));\n              } else {\n                dialoglog(\"ListAll\",session,send(\"i did not find any \" + category + \" for \" + a1.entity + \".\\n\" + joinresults.join(\";\\n\")));\n              }\n              return;\n            } else {\n              // no entity, e.g. list all countries\n              //\n              var categorySetFull = {} as { [key : string] : boolean};\n              try {\n                categorySetFull = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, false);\n              } catch(e) {\n                  debuglog(\"here exception\" + e);\n                  dialoglog(\"WhatIs\",session,send('I cannot combine \"' + category + '(' + e.toString() + ')'));\n              // next();\n                  return;\n              }\n              var resultT = ListAll.listAllTupelHavingContext(cats, \"\\\"\" + cats.join(\"\\\" \\\"\") + \"\\\"\", theModel.rules, theModel.records, categorySetFull);\n              logQueryWhatIsTupel(session, 'ListAll', resultT);\n              if (resultT.length) {\n                debuglog('listall result:' + JSON.stringify(resultT));\n                var joinresults = [];\n                debuglog(\"here is cat>\" + cats.join(\", \"));\n                if(cat !== \"example question\") {\n                  joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(resultT));\n                } else {\n                  joinresults = ListAll.joinResultsTupel(resultT);\n                }\n                var response = \"the \" + category + \" are ...\\n\" + joinresults.join(\";\\n\");\n                dialoglog(\"ListAll\",session,send(response));\n                return;\n              } else {\n                var response = \"Found no data having \\\"\" + cat + \"\\\"\"\n                dialoglog(\"ListAll\",session,send(response));\n                return;\n              }\n            }\n          }\n            */\n        });\n      });\n    }\n  ]);\n\n  dialog.matches('TrainMe', [\n    function (session, args, next) {\n      var isCombinedIndex = {};\n      var oNewEntity;\n      // expecting entity A1\n      var message = session.message.text;\n      debuglog(\"Intent : Train\");\n      debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);\n      var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'categories');\n      if (message.toLowerCase().indexOf(\"kronos\") >= 0 || message.toLowerCase().indexOf(\"klingon\") >= 0) {\n        dialoglog(\"TrainMe\", session, send(getRandomResult(aTrainNoKlingon)));\n        return;\n      }\n      var res = getRandomResult(aTrainReplies);\n      dialoglog(\"TrainMe\", session, send(res));\n    }\n  ]);\n\n  dialog.matches('TooLong', [\n    function (session, args, next) {\n      var isCombinedIndex = {};\n      var oNewEntity;\n      // expecting entity A1\n      var message = session.message.text;\n      debuglog(\"Intent : TooLong\");\n      debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);\n      var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'categories');\n      dialoglog(\"TooLong\", session, send(getRandomResult(aResponsesOnTooLong)));\n    }\n  ]);\n\n\n  dialog.matches('Wrong', [\n    function (session, args, next) {\n      /*\n      dialogLogger({\n        session: session,\n        intent: \"Wrong\",\n        response: '<begin updown>'\n      }); */\n      session.beginDialog('/updown', session.userData.count);\n    },\n    function (session, results, next) {\n      var alarm = session.dialogData.alarm;\n      next();\n    },\n    function (session, results) {\n      session.send(getRandomResult(aBackFromTraining)); //  + JSON.stringify(results));\n      //session.send('end of wrong');\n    }\n  ]);\n\n  dialog.matches('Exit', [\n    function (session, args, next) {\n      debuglog('exit :');\n      debuglog('exit' + JSON.stringify(args.entities));\n      dialogLogger({\n        session: session,\n        intent: \"Exit\",\n        response: 'you are in a logic loop'\n      });\n      session.send(\"you are in a logic loop \");\n    }\n  ]);\n  dialog.matches('Help', [\n    function (session, args, next) {\n      debuglog('help :');\n      debuglog('help');\n      session.send(\"I know about .... <categories>>\");\n    }\n  ]);\n\n  /*\n    // Add intent handlers\n    dialog.matches('train', [\n      function (session, args, next) {\n        debuglog('train');\n        // Resolve and store any entities passed from LUIS.\n        var title = builder.EntityRecognizer.findEntity(args.entities, 'builtin.alarm.title');\n        var time = builder.EntityRecognizer.resolveTime(args.entities);\n        var alarm = session.dialogData.alarm = {\n          title: title ? title.entity : null,\n          timestamp: time ? time.getTime() : null\n        };\n        // Prompt for title\n        if (!alarm.title) {\n          dialogLogger({\n            session: session,\n            intent: \"train\",\n            response: 'What fact would you like to train?'\n          });\n          builder.Prompts.text(session, 'What fact would you like to train?');\n        } else {\n          next();\n        }\n      },\n      function (session, results, next) {\n        var alarm = session.dialogData.alarm;\n        if (results.response) {\n          alarm.title = results.response;\n        }\n\n        // Prompt for time (title will be blank if the user said cancel)\n        if (alarm.title && !alarm.timestamp) {\n\n\n          builder.Prompts.time(session, 'What time would you like to set the alarm for?');\n        } else {\n          next();\n        }\n      },\n      function (session, results) {\n        var alarm = session.dialogData.alarm;\n        if (results.response) {\n          var time = builder.EntityRecognizer.resolveTime([results.response]);\n          alarm.timestamp = time ? time.getTime() : null;\n        }\n        // Set the alarm (if title or timestamp is blank the user said cancel)\n        if (alarm.title && alarm.timestamp) {\n          // Save address of who to notify and write to scheduler.\n          alarm.address = session.message.address;\n          //alarms[alarm.title] = alarm;\n\n          // Send confirmation to user\n          var date = new Date(alarm.timestamp);\n          var isAM = date.getHours() < 12;\n          session.send('Creating alarm named \"%s\" for %d/%d/%d %d:%02d%s',\n            alarm.title,\n            date.getMonth() + 1, date.getDate(), date.getFullYear(),\n            isAM ? date.getHours() : date.getHours() - 12, date.getMinutes(), isAM ? 'am' : 'pm');\n        } else {\n          session.send('Ok... no problem.');\n        }\n      }\n    ]);\n  */\n\n  dialog.onDefault(function (session) {\n    logQuery(session, \"onDefault\");\n    var eliza = getElizaBot(getConversationId(session));\n    var reply = eliza.transform(session.message.text);\n    dialoglog(\"eliza\", session, send(reply));\n    //new Eilzabot\n    //session.send(\"I do not understand this at all\");\n    //builder.DialogAction.send('I\\'m sorry I didn\\'t understand. I can only show start and ring');\n  });\n\n  /*\n  // Very simple alarm scheduler\n  var alarms = {};\n  setInterval(function () {\n    var now = new Date().getTime();\n    for (var key in alarms) {\n      var alarm = alarms[key];\n      if (now >= alarm.timestamp) {\n        var msg = new builder.Message()\n          .address(alarm.address)\n          .text('Here\\'s your \\'%s\\' alarm.', alarm.title);\n        bot.send(msg);\n        delete alarms[key];\n      }\n    }\n  }, 15000);\n  */\n  return bot;\n}\n\nif (module) {\n  module.exports = {\n    aTrainNoKlingon: aTrainNoKlingon,\n    aTrainReplies: aTrainReplies,\n    restrictData: restrictData,\n    isAnonymous: isAnonymous,\n    SimpleUpDownRecognizer: SimpleUpDownRecognizer,\n    aResponsesOnTooLong: aResponsesOnTooLong,\n    metawordsDescriptions: metawordsDescriptions,\n    makeBot: makeBot\n  };\n}\n"],"sourceRoot":"ABC"}